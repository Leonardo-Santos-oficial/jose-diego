<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocumentaÃ§Ã£o TÃ©cnica - Plataforma Aviator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            line-height: 1.6;
            color: #e0e0e0;
            background: #1a1a2e;
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: #16213e;
        }
        
        header {
            background: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
            color: #00d9ff;
            padding: 40px;
            text-align: center;
            border-bottom: 3px solid #00d9ff;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 217, 255, 0.5);
        }
        
        header p {
            font-size: 1.1em;
            color: #94a3b8;
        }
        
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: #0f0f23;
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid #333;
        }
        
        .sidebar h3 {
            color: #00d9ff;
            margin-bottom: 15px;
            font-size: 1em;
        }
        
        .sidebar ul {
            list-style: none;
        }
        
        .sidebar li {
            margin-bottom: 8px;
        }
        
        .sidebar a {
            color: #94a3b8;
            text-decoration: none;
            font-size: 0.85em;
            display: block;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .sidebar a:hover {
            background: #1a1a2e;
            color: #00d9ff;
        }
        
        .content {
            padding: 40px;
        }
        
        section {
            margin-bottom: 60px;
            padding-bottom: 40px;
            border-bottom: 1px solid #333;
        }
        
        h2 {
            color: #00d9ff;
            font-size: 1.8em;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #00d9ff;
        }
        
        h3 {
            color: #e94560;
            font-size: 1.3em;
            margin: 30px 0 15px 0;
        }
        
        h4 {
            color: #ffd700;
            font-size: 1.1em;
            margin: 20px 0 10px 0;
        }
        
        p {
            margin-bottom: 15px;
            color: #b0b0b0;
        }
        
        pre {
            background: #0f0f23;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            overflow-x: auto;
            margin: 15px 0;
            font-size: 0.9em;
        }
        
        code {
            color: #00ff88;
        }
        
        .inline-code {
            background: #0f0f23;
            color: #ff6b6b;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #0f0f23;
            border-radius: 8px;
            overflow: hidden;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #333;
        }
        
        th {
            background: #1a1a2e;
            color: #00d9ff;
            font-weight: bold;
        }
        
        td {
            color: #b0b0b0;
        }
        
        tr:hover {
            background: #1a1a2e;
        }
        
        .diagram {
            background: #0f0f23;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Consolas', monospace;
            white-space: pre;
            overflow-x: auto;
            color: #94a3b8;
            font-size: 0.85em;
            line-height: 1.4;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin-right: 5px;
        }
        
        .badge-blue { background: #0066cc; color: white; }
        .badge-green { background: #00aa55; color: white; }
        .badge-orange { background: #ff8800; color: white; }
        .badge-purple { background: #9933ff; color: white; }
        .badge-red { background: #cc3333; color: white; }
        
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid;
        }
        
        .alert-info {
            background: rgba(0, 217, 255, 0.1);
            border-color: #00d9ff;
            color: #00d9ff;
        }
        
        .alert-warning {
            background: rgba(255, 193, 7, 0.1);
            border-color: #ffc107;
            color: #ffc107;
        }
        
        .alert-danger {
            background: rgba(233, 69, 96, 0.1);
            border-color: #e94560;
            color: #e94560;
        }
        
        .alert-success {
            background: rgba(0, 255, 136, 0.1);
            border-color: #00ff88;
            color: #00ff88;
        }
        
        ul, ol {
            margin: 15px 0 15px 30px;
            color: #b0b0b0;
        }
        
        li {
            margin-bottom: 8px;
        }
        
        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .tech-item {
            background: #0f0f23;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #333;
        }
        
        .tech-item h5 {
            color: #00d9ff;
            margin-bottom: 5px;
        }
        
        .tech-item p {
            color: #94a3b8;
            font-size: 0.9em;
            margin: 0;
        }
        
        .file-tree {
            background: #0f0f23;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Consolas', monospace;
            font-size: 0.9em;
            color: #94a3b8;
        }
        
        .file-tree .folder {
            color: #ffd700;
        }
        
        .file-tree .file {
            color: #00ff88;
        }
        
        footer {
            background: #0f0f23;
            color: #94a3b8;
            text-align: center;
            padding: 30px;
            border-top: 1px solid #333;
        }
        
        @media print {
            body {
                background: white;
                color: #333;
            }
            .container {
                background: white;
            }
            pre, .diagram {
                background: #f5f5f5;
                border-color: #ddd;
            }
            code {
                color: #d63384;
            }
            h2, h3 {
                color: #333;
            }
        }
        
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }
            .content {
                padding: 20px;
            }
            pre, .diagram {
                font-size: 0.75em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>âš™ï¸ DocumentaÃ§Ã£o TÃ©cnica</h1>
            <p>Plataforma Aviator - Guia para Desenvolvedores</p>
        </header>
        
        <div class="content">
            <!-- Ãndice -->
            <section id="indice">
                <h2>ğŸ“‘ Ãndice</h2>
                <ol>
                    <li><a href="#arquitetura" style="color: #00d9ff;">VisÃ£o Geral da Arquitetura</a></li>
                    <li><a href="#stack" style="color: #00d9ff;">Stack TecnolÃ³gica</a></li>
                    <li><a href="#estrutura" style="color: #00d9ff;">Estrutura do Projeto</a></li>
                    <li><a href="#ambiente" style="color: #00d9ff;">ConfiguraÃ§Ã£o do Ambiente</a></li>
                    <li><a href="#banco" style="color: #00d9ff;">Banco de Dados</a></li>
                    <li><a href="#apis" style="color: #00d9ff;">APIs e Endpoints</a></li>
                    <li><a href="#auth" style="color: #00d9ff;">AutenticaÃ§Ã£o e AutorizaÃ§Ã£o</a></li>
                    <li><a href="#realtime" style="color: #00d9ff;">Sistema de Tempo Real</a></li>
                    <li><a href="#engine" style="color: #00d9ff;">Motor do Jogo (Engine)</a></li>
                    <li><a href="#upload" style="color: #00d9ff;">Sistema de Upload</a></li>
                    <li><a href="#chat" style="color: #00d9ff;">Sistema de Chat</a></li>
                    <li><a href="#admin" style="color: #00d9ff;">Painel Administrativo</a></li>
                    <li><a href="#testes" style="color: #00d9ff;">Testes</a></li>
                    <li><a href="#deploy" style="color: #00d9ff;">Deploy e Infraestrutura</a></li>
                    <li><a href="#troubleshooting" style="color: #00d9ff;">ManutenÃ§Ã£o e Troubleshooting</a></li>
                </ol>
            </section>

            <!-- 1. Arquitetura -->
            <section id="arquitetura">
                <h2>1. VisÃ£o Geral da Arquitetura</h2>
                
                <h3>1.1 Diagrama de Arquitetura</h3>
                <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CLIENTE (Browser)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Next.js App   â”‚  â”‚  Realtime WS    â”‚  â”‚  Supabase Client   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚                     â”‚
            â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Vercel Edge     â”‚  â”‚   Node Service      â”‚  â”‚   Supabase Cloud    â”‚
â”‚   (Next.js SSR)   â”‚  â”‚   (Game Engine)     â”‚  â”‚   (BaaS)            â”‚
â”‚                   â”‚  â”‚                     â”‚  â”‚                     â”‚
â”‚  - Server Actions â”‚  â”‚  - Socket.IO        â”‚  â”‚  - PostgreSQL       â”‚
â”‚  - API Routes     â”‚  â”‚  - Game Loop        â”‚  â”‚  - Realtime         â”‚
â”‚  - Middleware     â”‚  â”‚  - Bet Processing   â”‚  â”‚  - Storage          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  - Auth             â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                </div>
                
                <h3>1.2 Fluxo de Dados</h3>
                <div class="diagram">
UsuÃ¡rio â”€â”€â–º Next.js â”€â”€â–º Server Actions â”€â”€â–º Supabase
                â”‚
                â””â”€â”€â–º API Routes â”€â”€â–º Node Service (Engine)
                            â”‚
                            â””â”€â”€â–º Supabase Realtime â”€â”€â–º Broadcast para clientes
                </div>
                
                <h3>1.3 Componentes Principais</h3>
                <table>
                    <tr>
                        <th>Componente</th>
                        <th>Responsabilidade</th>
                    </tr>
                    <tr>
                        <td><strong>Next.js App</strong></td>
                        <td>Frontend React, SSR, Server Actions</td>
                    </tr>
                    <tr>
                        <td><strong>Node Service</strong></td>
                        <td>Motor do jogo, WebSocket, processamento de apostas</td>
                    </tr>
                    <tr>
                        <td><strong>Supabase</strong></td>
                        <td>Banco de dados, autenticaÃ§Ã£o, storage, realtime</td>
                    </tr>
                    <tr>
                        <td><strong>Vercel</strong></td>
                        <td>Hospedagem do frontend, edge functions</td>
                    </tr>
                </table>
            </section>

            <!-- 2. Stack -->
            <section id="stack">
                <h2>2. Stack TecnolÃ³gica</h2>
                
                <h3>2.1 Frontend</h3>
                <div class="tech-stack">
                    <div class="tech-item">
                        <h5>Next.js 15.x</h5>
                        <p>Framework React com App Router</p>
                    </div>
                    <div class="tech-item">
                        <h5>React 19.x</h5>
                        <p>Biblioteca UI</p>
                    </div>
                    <div class="tech-item">
                        <h5>TypeScript 5.x</h5>
                        <p>Tipagem estÃ¡tica</p>
                    </div>
                    <div class="tech-item">
                        <h5>Tailwind CSS 3.x</h5>
                        <p>EstilizaÃ§Ã£o utility-first</p>
                    </div>
                    <div class="tech-item">
                        <h5>shadcn/ui</h5>
                        <p>Componentes UI</p>
                    </div>
                    <div class="tech-item">
                        <h5>Zod 3.x</h5>
                        <p>ValidaÃ§Ã£o de schemas</p>
                    </div>
                </div>
                
                <h3>2.2 Backend</h3>
                <div class="tech-stack">
                    <div class="tech-item">
                        <h5>Node.js 20.x</h5>
                        <p>Runtime JavaScript</p>
                    </div>
                    <div class="tech-item">
                        <h5>Fastify 4.x</h5>
                        <p>Framework HTTP</p>
                    </div>
                    <div class="tech-item">
                        <h5>Socket.IO 4.x</h5>
                        <p>WebSocket realtime</p>
                    </div>
                    <div class="tech-item">
                        <h5>Pino 8.x</h5>
                        <p>Logging</p>
                    </div>
                </div>
                
                <h3>2.3 Banco de Dados e ServiÃ§os</h3>
                <table>
                    <tr>
                        <th>Tecnologia</th>
                        <th>Uso</th>
                    </tr>
                    <tr>
                        <td>Supabase</td>
                        <td>BaaS (Backend as a Service)</td>
                    </tr>
                    <tr>
                        <td>PostgreSQL</td>
                        <td>Banco de dados relacional</td>
                    </tr>
                    <tr>
                        <td>Supabase Realtime</td>
                        <td>ComunicaÃ§Ã£o em tempo real</td>
                    </tr>
                    <tr>
                        <td>Supabase Storage</td>
                        <td>Armazenamento de arquivos</td>
                    </tr>
                    <tr>
                        <td>Supabase Auth</td>
                        <td>AutenticaÃ§Ã£o</td>
                    </tr>
                </table>
                
                <h3>2.4 Ferramentas de Desenvolvimento</h3>
                <table>
                    <tr>
                        <th>Ferramenta</th>
                        <th>Uso</th>
                    </tr>
                    <tr>
                        <td>Vitest</td>
                        <td>Testes unitÃ¡rios</td>
                    </tr>
                    <tr>
                        <td>Playwright</td>
                        <td>Testes E2E</td>
                    </tr>
                    <tr>
                        <td>ESLint</td>
                        <td>Linting</td>
                    </tr>
                    <tr>
                        <td>Prettier</td>
                        <td>FormataÃ§Ã£o de cÃ³digo</td>
                    </tr>
                    <tr>
                        <td>tsup</td>
                        <td>Bundling do Node Service</td>
                    </tr>
                    <tr>
                        <td>PM2</td>
                        <td>Gerenciador de processos</td>
                    </tr>
                </table>
            </section>

            <!-- 3. Estrutura -->
            <section id="estrutura">
                <h2>3. Estrutura do Projeto</h2>
                
                <h3>3.1 Estrutura Geral</h3>
                <div class="file-tree">
<span class="folder">projeto/</span>
â”œâ”€â”€ <span class="folder">web/</span>                    # Frontend Next.js
â”‚   â”œâ”€â”€ <span class="folder">app/</span>               # App Router (pÃ¡ginas e rotas)
â”‚   â”œâ”€â”€ <span class="folder">src/</span>               # CÃ³digo fonte
â”‚   â”‚   â”œâ”€â”€ <span class="folder">components/</span>    # Componentes React
â”‚   â”‚   â”œâ”€â”€ <span class="folder">modules/</span>       # MÃ³dulos de domÃ­nio
â”‚   â”‚   â”œâ”€â”€ <span class="folder">lib/</span>          # Bibliotecas e utilitÃ¡rios
â”‚   â”‚   â”œâ”€â”€ <span class="folder">hooks/</span>        # React Hooks customizados
â”‚   â”‚   â””â”€â”€ <span class="folder">config/</span>       # ConfiguraÃ§Ãµes
â”‚   â”œâ”€â”€ <span class="folder">public/</span>           # Assets estÃ¡ticos
â”‚   â””â”€â”€ <span class="folder">supabase/</span>         # Migrations e seeds
â”‚
â”œâ”€â”€ <span class="folder">node-service/</span>          # Backend Node.js (Engine)
â”‚   â”œâ”€â”€ <span class="folder">src/</span>
â”‚   â”‚   â”œâ”€â”€ <span class="folder">loop/</span>         # Game loop
â”‚   â”‚   â”œâ”€â”€ <span class="folder">strategy/</span>     # EstratÃ©gias de crash
â”‚   â”‚   â”œâ”€â”€ <span class="folder">services/</span>     # ServiÃ§os de negÃ³cio
â”‚   â”‚   â”œâ”€â”€ <span class="folder">routes/</span>       # Rotas HTTP
â”‚   â”‚   â””â”€â”€ <span class="folder">publisher/</span>    # PublicaÃ§Ã£o de eventos
â”‚   â””â”€â”€ <span class="file">ecosystem.config.cjs</span>  # ConfiguraÃ§Ã£o PM2
â”‚
â”œâ”€â”€ <span class="folder">docs/</span>                  # DocumentaÃ§Ã£o
â””â”€â”€ <span class="folder">deploy/</span>               # Scripts de deploy
                </div>
                
                <h3>3.2 Estrutura do Frontend</h3>
                <div class="file-tree">
<span class="folder">web/</span>
â”œâ”€â”€ <span class="folder">app/</span>                          # Next.js App Router
â”‚   â”œâ”€â”€ <span class="file">layout.tsx</span>               # Layout raiz
â”‚   â”œâ”€â”€ <span class="file">page.tsx</span>                 # PÃ¡gina inicial (/)
â”‚   â”œâ”€â”€ <span class="folder">app/</span>                     # Ãrea do jogo (/app)
â”‚   â”œâ”€â”€ <span class="folder">admin/</span>                   # Painel admin (/admin)
â”‚   â”œâ”€â”€ <span class="folder">profile/</span>                 # Perfil do usuÃ¡rio (/profile)
â”‚   â”œâ”€â”€ <span class="folder">beneficios/</span>              # Programa de benefÃ­cios
â”‚   â”œâ”€â”€ <span class="folder">auth/</span>                    # Callbacks de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ <span class="folder">api/</span>                     # API Routes
â”‚   â””â”€â”€ <span class="folder">actions/</span>                 # Server Actions
â”‚
â”œâ”€â”€ <span class="folder">src/</span>
â”‚   â”œâ”€â”€ <span class="folder">components/</span>
â”‚   â”‚   â”œâ”€â”€ <span class="folder">admin/</span>              # Componentes do admin
â”‚   â”‚   â”œâ”€â”€ <span class="folder">chat/</span>               # Chat de suporte
â”‚   â”‚   â”œâ”€â”€ <span class="folder">global-chat/</span>        # Chat global
â”‚   â”‚   â”œâ”€â”€ <span class="folder">game/</span>               # Componentes do jogo
â”‚   â”‚   â”œâ”€â”€ <span class="folder">profile/</span>            # Componentes de perfil
â”‚   â”‚   â””â”€â”€ <span class="folder">ui/</span>                 # Componentes base (shadcn)
â”‚   â”‚
â”‚   â”œâ”€â”€ <span class="folder">modules/</span>
â”‚   â”‚   â”œâ”€â”€ <span class="folder">admin/</span>              # LÃ³gica do admin
â”‚   â”‚   â”œâ”€â”€ <span class="folder">chat/</span>               # Sistema de chat
â”‚   â”‚   â”œâ”€â”€ <span class="folder">global-chat/</span>        # Chat global
â”‚   â”‚   â”œâ”€â”€ <span class="folder">upload/</span>             # Sistema de upload
â”‚   â”‚   â””â”€â”€ <span class="folder">withdraw/</span>           # Sistema de saques
â”‚   â”‚
â”‚   â”œâ”€â”€ <span class="folder">lib/</span>
â”‚   â”‚   â”œâ”€â”€ <span class="folder">auth/</span>               # AutenticaÃ§Ã£o
â”‚   â”‚   â”œâ”€â”€ <span class="folder">supabase/</span>           # Clientes Supabase
â”‚   â”‚   â””â”€â”€ <span class="folder">realtime/</span>           # Clientes realtime
â”‚   â”‚
â”‚   â””â”€â”€ <span class="folder">hooks/</span>                  # React Hooks
                </div>
            </section>

            <!-- 4. Ambiente -->
            <section id="ambiente">
                <h2>4. ConfiguraÃ§Ã£o do Ambiente</h2>
                
                <h3>4.1 VariÃ¡veis de Ambiente - Frontend</h3>
                <p>Arquivo: <span class="inline-code">web/.env.local</span></p>
                <pre><code># Supabase
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Node Service
NEXT_PUBLIC_NODE_SERVICE_URL=http://localhost:3001
NODE_SERVICE_INTERNAL_URL=http://localhost:3001

# Auth
NEXTAUTH_SECRET=sua-chave-secreta
NEXTAUTH_URL=http://localhost:3000

# Optional
NEXT_PUBLIC_SITE_URL=http://localhost:3000</code></pre>
                
                <h3>4.2 VariÃ¡veis de Ambiente - Node Service</h3>
                <p>Arquivo: <span class="inline-code">node-service/.env</span></p>
                <pre><code># Server
PORT=3001
HOST=0.0.0.0
NODE_ENV=production

# Supabase
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Game Settings
GAME_TICK_INTERVAL=100
GAME_BET_PHASE_DURATION=10000
GAME_MIN_MULTIPLIER=1.0
GAME_MAX_MULTIPLIER=100.0

# Logging
LOG_LEVEL=info</code></pre>
                
                <h3>4.3 InstalaÃ§Ã£o e ExecuÃ§Ã£o</h3>
                <pre><code># Clone o repositÃ³rio
git clone &lt;repo-url&gt;

# Frontend
cd web
npm install
npm run dev

# Node Service (outro terminal)
cd node-service
npm install
npm run dev</code></pre>
                
                <h3>4.4 Scripts DisponÃ­veis</h3>
                
                <h4>Frontend (web/package.json)</h4>
                <table>
                    <tr>
                        <th>Script</th>
                        <th>Comando</th>
                        <th>DescriÃ§Ã£o</th>
                    </tr>
                    <tr>
                        <td><span class="inline-code">dev</span></td>
                        <td>next dev --turbopack</td>
                        <td>Desenvolvimento com Turbopack</td>
                    </tr>
                    <tr>
                        <td><span class="inline-code">build</span></td>
                        <td>next build</td>
                        <td>Build de produÃ§Ã£o</td>
                    </tr>
                    <tr>
                        <td><span class="inline-code">start</span></td>
                        <td>next start</td>
                        <td>Inicia servidor de produÃ§Ã£o</td>
                    </tr>
                    <tr>
                        <td><span class="inline-code">test</span></td>
                        <td>vitest</td>
                        <td>Executa testes</td>
                    </tr>
                    <tr>
                        <td><span class="inline-code">test:e2e</span></td>
                        <td>playwright test</td>
                        <td>Testes E2E</td>
                    </tr>
                </table>
                
                <h4>Node Service (node-service/package.json)</h4>
                <table>
                    <tr>
                        <th>Script</th>
                        <th>Comando</th>
                        <th>DescriÃ§Ã£o</th>
                    </tr>
                    <tr>
                        <td><span class="inline-code">dev</span></td>
                        <td>tsx watch src/index.ts</td>
                        <td>Desenvolvimento com hot reload</td>
                    </tr>
                    <tr>
                        <td><span class="inline-code">build</span></td>
                        <td>tsup</td>
                        <td>Build de produÃ§Ã£o</td>
                    </tr>
                    <tr>
                        <td><span class="inline-code">start</span></td>
                        <td>node dist/index.js</td>
                        <td>Inicia servidor</td>
                    </tr>
                    <tr>
                        <td><span class="inline-code">test</span></td>
                        <td>vitest</td>
                        <td>Executa testes</td>
                    </tr>
                </table>
            </section>

            <!-- 5. Banco de Dados -->
            <section id="banco">
                <h2>5. Banco de Dados</h2>
                
                <h3>5.1 Diagrama ER</h3>
                <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   auth.users    â”‚     â”‚  user_profiles  â”‚     â”‚    wallets      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚â”€â”€â”€â”€â–ºâ”‚ user_id (FK,PK) â”‚â”€â”€â”€â”€â–ºâ”‚ user_id (FK,PK) â”‚
â”‚ email           â”‚     â”‚ display_name    â”‚     â”‚ balance         â”‚
â”‚ created_at      â”‚     â”‚ avatar_url      â”‚     â”‚ updated_at      â”‚
â”‚ ...             â”‚     â”‚ pix_key         â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ bank_*          â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚                       â”‚
        â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      bets       â”‚     â”‚ withdraw_requestsâ”‚    â”‚  chat_threads   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚     â”‚ id (PK)         â”‚     â”‚ id (PK)         â”‚
â”‚ user_id (FK)    â”‚     â”‚ user_id (FK)    â”‚     â”‚ user_id (FK)    â”‚
â”‚ round_id        â”‚     â”‚ amount          â”‚     â”‚ status          â”‚
â”‚ amount          â”‚     â”‚ status          â”‚     â”‚ created_at      â”‚
â”‚ cash_out_at     â”‚     â”‚ pix_key         â”‚     â”‚ updated_at      â”‚
â”‚ multiplier      â”‚     â”‚ bank_*          â”‚     â”‚ metadata        â”‚
â”‚ status          â”‚     â”‚ created_at      â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ created_at      â”‚     â”‚ processed_at    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                                                         â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚  chat_messages  â”‚
                                                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                                â”‚ id (PK)         â”‚
                                                â”‚ thread_id (FK)  â”‚
                                                â”‚ user_id (FK)    â”‚
                                                â”‚ sender_role     â”‚
                                                â”‚ body            â”‚
                                                â”‚ attachment_url  â”‚
                                                â”‚ attachment_type â”‚
                                                â”‚ created_at      â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                </div>
                
                <h3>5.2 Tabelas Principais</h3>
                
                <h4>user_profiles</h4>
                <pre><code>CREATE TABLE user_profiles (
  user_id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  display_name TEXT,
  avatar_url TEXT,
  pix_key TEXT,
  bank_name TEXT,
  bank_agency TEXT,
  bank_account TEXT,
  bank_account_type TEXT,
  bank_holder_name TEXT,
  bank_holder_document TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);</code></pre>
                
                <h4>wallets</h4>
                <pre><code>CREATE TABLE wallets (
  user_id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  balance DECIMAL(15,2) DEFAULT 0.00,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);</code></pre>
                
                <h4>bets</h4>
                <pre><code>CREATE TABLE bets (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id),
  round_id TEXT NOT NULL,
  amount DECIMAL(15,2) NOT NULL,
  cash_out_at DECIMAL(10,2),
  multiplier DECIMAL(10,2),
  profit DECIMAL(15,2),
  status TEXT DEFAULT 'pending', -- pending, won, lost, cashed_out
  created_at TIMESTAMPTZ DEFAULT NOW()
);</code></pre>
                
                <h4>chat_messages</h4>
                <pre><code>CREATE TABLE chat_messages (
  id BIGSERIAL PRIMARY KEY,
  thread_id UUID REFERENCES chat_threads(id) ON DELETE CASCADE,
  user_id UUID REFERENCES auth.users(id),
  sender_role TEXT NOT NULL, -- user, admin
  body TEXT NOT NULL,
  attachment_url TEXT,
  attachment_type TEXT, -- image, document
  attachment_name TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);</code></pre>
                
                <h3>5.3 Row Level Security (RLS)</h3>
                <pre><code>-- Exemplo: UsuÃ¡rios sÃ³ podem ver/editar seu prÃ³prio perfil
ALTER TABLE user_profiles ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own profile"
  ON user_profiles FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can update own profile"
  ON user_profiles FOR UPDATE
  USING (auth.uid() = user_id);

-- Storage policies para avatars
CREATE POLICY "Users can upload their own avatar"
  ON storage.objects FOR INSERT
  WITH CHECK (bucket_id = 'avatars' AND auth.role() = 'authenticated');

CREATE POLICY "Anyone can view avatars"
  ON storage.objects FOR SELECT
  USING (bucket_id = 'avatars');</code></pre>
            </section>

            <!-- 6. APIs -->
            <section id="apis">
                <h2>6. APIs e Endpoints</h2>
                
                <h3>6.1 API Routes (Next.js)</h3>
                
                <h4>Aviator Game</h4>
                <table>
                    <tr>
                        <th>MÃ©todo</th>
                        <th>Endpoint</th>
                        <th>DescriÃ§Ã£o</th>
                    </tr>
                    <tr>
                        <td><span class="badge badge-green">POST</span></td>
                        <td>/api/aviator/bets</td>
                        <td>Criar nova aposta</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-green">POST</span></td>
                        <td>/api/aviator/cashout</td>
                        <td>Fazer cash out</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-green">POST</span></td>
                        <td>/api/aviator/tick</td>
                        <td>Tick do jogo (interno)</td>
                    </tr>
                </table>
                
                <h4>POST /api/aviator/bets</h4>
                <pre><code>// Request
{
  "amount": 10.00,
  "roundId": "round-123"
}

// Response
{
  "success": true,
  "bet": {
    "id": "bet-uuid",
    "amount": 10.00,
    "roundId": "round-123",
    "status": "pending"
  }
}</code></pre>
                
                <h4>POST /api/aviator/cashout</h4>
                <pre><code>// Request
{
  "betId": "bet-uuid",
  "multiplier": 2.50
}

// Response
{
  "success": true,
  "profit": 25.00,
  "multiplier": 2.50
}</code></pre>
                
                <h3>6.2 Server Actions</h3>
                
                <h4>AutenticaÃ§Ã£o (app/actions/auth.ts)</h4>
                <pre><code>// Login
export async function loginAction(formData: FormData): Promise&lt;AuthActionState&gt;

// Logout
export async function logoutAction(): Promise&lt;void&gt;

// Registro
export async function registerAction(formData: FormData): Promise&lt;AuthActionState&gt;</code></pre>
                
                <h4>Perfil (app/actions/profile.ts)</h4>
                <pre><code>// Atualizar perfil
export async function updateProfileAction(formData: FormData): Promise&lt;ProfileActionState&gt;

// Atualizar configuraÃ§Ãµes de saque
export async function updateWithdrawSettingsAction(formData: FormData): Promise&lt;ProfileActionState&gt;</code></pre>
                
                <h4>Upload (app/actions/upload-avatar.ts)</h4>
                <pre><code>// Upload de avatar
export async function uploadAvatarAction(formData: FormData): Promise&lt;UploadAvatarResult&gt;

// Upload de anexo do chat
export async function uploadChatAttachmentAction(formData: FormData): Promise&lt;UploadChatAttachmentResult&gt;</code></pre>
            </section>

            <!-- 7. Auth -->
            <section id="auth">
                <h2>7. AutenticaÃ§Ã£o e AutorizaÃ§Ã£o</h2>
                
                <h3>7.1 Fluxo de AutenticaÃ§Ã£o</h3>
                <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cliente   â”‚â”€â”€â”€â”€â–ºâ”‚  Next.js    â”‚â”€â”€â”€â”€â–ºâ”‚  Supabase   â”‚
â”‚   (Login)   â”‚     â”‚  Middleware â”‚     â”‚    Auth     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â”‚                   â”‚    JWT Token      â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                   â”‚                   â”‚
       â”‚  Cookie com       â”‚                   â”‚
       â”‚  Session Token    â”‚                   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
                </div>
                
                <h3>7.2 VerificaÃ§Ã£o de Admin</h3>
                <pre><code>// web/src/lib/auth/roles.ts
export function isAdminSession(session: Session | null): boolean {
  if (!session?.user) return false;
  
  const adminEmails = [
    'admin@example.com',
    'leonardosantosaki@gmail.com',
    // ... outros admins
  ];
  
  return adminEmails.includes(session.user.email ?? '');
}</code></pre>
                
                <h3>7.3 Clientes Supabase</h3>
                <table>
                    <tr>
                        <th>Cliente</th>
                        <th>Uso</th>
                        <th>Arquivo</th>
                    </tr>
                    <tr>
                        <td><span class="inline-code">getSupabaseClient()</span></td>
                        <td>Browser (client-side)</td>
                        <td>lib/supabaseClient.ts</td>
                    </tr>
                    <tr>
                        <td><span class="inline-code">getSupabaseServerClient()</span></td>
                        <td>Server Components/Actions</td>
                        <td>lib/supabase/serverClient.ts</td>
                    </tr>
                    <tr>
                        <td><span class="inline-code">getSupabaseServiceRoleClient()</span></td>
                        <td>Admin operations</td>
                        <td>lib/supabase/serviceRoleClient.ts</td>
                    </tr>
                </table>
            </section>

            <!-- 8. Realtime -->
            <section id="realtime">
                <h2>8. Sistema de Tempo Real</h2>
                
                <h3>8.1 Canais Realtime</h3>
                <table>
                    <tr>
                        <th>Canal</th>
                        <th>Tipo</th>
                        <th>Uso</th>
                    </tr>
                    <tr>
                        <td><span class="inline-code">aviator:game</span></td>
                        <td>Broadcast</td>
                        <td>Estado do jogo (tick, rodadas)</td>
                    </tr>
                    <tr>
                        <td><span class="inline-code">chat:support:{threadId}</span></td>
                        <td>Broadcast</td>
                        <td>Mensagens de suporte</td>
                    </tr>
                    <tr>
                        <td><span class="inline-code">chat:global</span></td>
                        <td>Broadcast</td>
                        <td>Chat global</td>
                    </tr>
                    <tr>
                        <td><span class="inline-code">bets:user:{userId}</span></td>
                        <td>Postgres Changes</td>
                        <td>AtualizaÃ§Ãµes de apostas</td>
                    </tr>
                </table>
                
                <h3>8.2 Cliente Realtime (Frontend)</h3>
                <pre><code>// lib/realtime/aviatorClient.ts
export class AviatorRealtimeClient {
  private channel: RealtimeChannel;
  
  subscribe(callback: (event: AviatorEvent) => void) {
    this.channel = supabase
      .channel('aviator:game')
      .on('broadcast', { event: 'tick' }, (payload) => {
        callback(payload);
      })
      .on('broadcast', { event: 'round_start' }, (payload) => {
        callback(payload);
      })
      .on('broadcast', { event: 'round_end' }, (payload) => {
        callback(payload);
      })
      .subscribe();
  }
  
  dispose() {
    this.channel?.unsubscribe();
  }
}</code></pre>
            </section>

            <!-- 9. Engine -->
            <section id="engine">
                <h2>9. Motor do Jogo (Engine)</h2>
                
                <h3>9.1 Estados do Jogo</h3>
                <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   BETTING   â”‚â”€â”€â”€â”€â–ºâ”‚   FLYING    â”‚â”€â”€â”€â”€â–ºâ”‚   CRASHED   â”‚
â”‚  (5-10s)    â”‚     â”‚  (variÃ¡vel) â”‚     â”‚   (2-3s)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â–²                                        â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                </div>
                
                <h3>9.2 Game Loop</h3>
                <pre><code>// Ciclo simplificado do jogo
class GameLoop {
  private state: 'betting' | 'flying' | 'crashed' = 'betting';
  private multiplier: number = 1.0;
  private targetCrash: number;
  
  async tick() {
    switch (this.state) {
      case 'betting':
        // Fase de apostas (5-10 segundos)
        // Aceitar novas apostas
        break;
        
      case 'flying':
        // AviÃ£o voando, multiplicador subindo
        this.multiplier += 0.01;
        this.publishTick(this.multiplier);
        
        if (this.multiplier >= this.targetCrash) {
          this.crash();
        }
        break;
        
      case 'crashed':
        // Processar perdas
        // Iniciar nova rodada
        this.startNewRound();
        break;
    }
  }
}</code></pre>
                
                <h3>9.3 EstratÃ©gia de Crash</h3>
                <pre><code>// EstratÃ©gia padrÃ£o (distribuiÃ§Ã£o exponencial)
class DefaultCrashStrategy implements CrashStrategy {
  pickTargetMultiplier(): number {
    // Algoritmo que garante house edge
    const houseEdge = 0.05; // 5%
    const random = Math.random();
    
    // DistribuiÃ§Ã£o exponencial inversa
    return Math.max(1.0, (1 / (1 - random * (1 - houseEdge))));
  }
}</code></pre>
            </section>

            <!-- 10. Upload -->
            <section id="upload">
                <h2>10. Sistema de Upload</h2>
                
                <h3>10.1 ConfiguraÃ§Ã£o</h3>
                <pre><code>// modules/upload/types.ts
export const UPLOAD_CONFIGS: Record&lt;UploadDestination, UploadConfig&gt; = {
  avatar: {
    maxSizeBytes: 2 * 1024 * 1024, // 2MB
    allowedMimeTypes: ['image/jpeg', 'image/png', 'image/webp', 'image/gif'],
    bucket: 'avatars',
    pathPrefix: 'users',
  },
  'chat-attachment': {
    maxSizeBytes: 10 * 1024 * 1024, // 10MB
    allowedMimeTypes: ['image/jpeg', 'image/png', 'image/webp', 'image/gif', 'application/pdf'],
    bucket: 'chat-attachments',
    pathPrefix: 'threads',
  },
};</code></pre>
                
                <h3>10.2 Buckets do Storage</h3>
                <table>
                    <tr>
                        <th>Bucket</th>
                        <th>PÃºblico</th>
                        <th>Uso</th>
                    </tr>
                    <tr>
                        <td><span class="inline-code">avatars</span></td>
                        <td>Sim</td>
                        <td>Fotos de perfil dos usuÃ¡rios</td>
                    </tr>
                    <tr>
                        <td><span class="inline-code">chat-attachments</span></td>
                        <td>Sim</td>
                        <td>Anexos do chat de suporte</td>
                    </tr>
                </table>
            </section>

            <!-- 11. Chat -->
            <section id="chat">
                <h2>11. Sistema de Chat</h2>
                
                <h3>11.1 ChatService</h3>
                <pre><code>class ChatService {
  // Obter ou criar thread para usuÃ¡rio
  async getOrCreateThread(userId: string): Promise&lt;ChatThread&gt;
  
  // Listar threads (admin)
  async listThreadsForAdmin(options: ListOptions): Promise&lt;ChatThread[]&gt;
  
  // Listar mensagens de uma thread
  async listMessages(threadId: string, limit?: number): Promise&lt;ChatMessage[]&gt;
  
  // Adicionar mensagem
  async appendMessage(options: AppendMessageOptions): Promise&lt;ChatMessage&gt;
  
  // Atualizar status da thread
  async updateThreadStatus(threadId: string, status: ThreadStatus): Promise&lt;ChatThread&gt;
}</code></pre>
            </section>

            <!-- 12. Admin -->
            <section id="admin">
                <h2>12. Painel Administrativo</h2>
                
                <h3>12.1 Funcionalidades</h3>
                <table>
                    <tr>
                        <th>Funcionalidade</th>
                        <th>DescriÃ§Ã£o</th>
                        <th>Rota</th>
                    </tr>
                    <tr>
                        <td>Dashboard</td>
                        <td>VisÃ£o geral de usuÃ¡rios e apostas</td>
                        <td>/admin</td>
                    </tr>
                    <tr>
                        <td>UsuÃ¡rios</td>
                        <td>Lista de todos os usuÃ¡rios</td>
                        <td>/admin (tab)</td>
                    </tr>
                    <tr>
                        <td>Saques</td>
                        <td>GestÃ£o de saques</td>
                        <td>/admin/withdrawals</td>
                    </tr>
                    <tr>
                        <td>Suporte</td>
                        <td>Inbox de chat</td>
                        <td>/admin (tab)</td>
                    </tr>
                </table>
                
                <h3>12.2 Fluxo de AprovaÃ§Ã£o de Saques</h3>
                <pre><code>// Estados do saque
type WithdrawStatus = 'pending' | 'approved' | 'paid' | 'rejected';

// AÃ§Ãµes do admin
async function approveWithdraw(requestId: string) {
  await updateWithdrawRequest(requestId, { 
    status: 'approved',
    processedAt: new Date(),
    processedBy: adminId
  });
}

async function rejectWithdraw(requestId: string, reason: string) {
  await updateWithdrawRequest(requestId, {
    status: 'rejected',
    adminNotes: reason,
    processedAt: new Date(),
    processedBy: adminId
  });
  
  // Devolver saldo ao usuÃ¡rio
  await creditWallet(request.userId, request.amount);
}</code></pre>
            </section>

            <!-- 13. Testes -->
            <section id="testes">
                <h2>13. Testes</h2>
                
                <h3>13.1 Estrutura de Testes</h3>
                <div class="file-tree">
<span class="folder">web/src/</span>
â”œâ”€â”€ <span class="folder">modules/</span>
â”‚   â”œâ”€â”€ <span class="folder">upload/__tests__/</span>        # Testes do mÃ³dulo upload
â”‚   â”‚   â”œâ”€â”€ <span class="file">fileValidator.test.ts</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">avatarUploadStrategy.test.ts</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">chatAttachmentUploadStrategy.test.ts</span>
â”‚   â”‚   â””â”€â”€ <span class="file">uploadFacade.test.ts</span>
â”‚   â”‚
â”‚   â””â”€â”€ <span class="folder">chat/__tests__/</span>          # Testes do mÃ³dulo chat
â”‚       â”œâ”€â”€ <span class="file">chatService.test.ts</span>
â”‚       â””â”€â”€ <span class="file">types.test.ts</span>
â”‚
â””â”€â”€ <span class="folder">tests/</span>                       # Testes E2E (Playwright)
    â””â”€â”€ <span class="file">admin-realtime.spec.ts</span>
                </div>
                
                <h3>13.2 Executando Testes</h3>
                <pre><code># Testes unitÃ¡rios
npm run test

# Testes especÃ­ficos
npm run test -- src/modules/upload

# Watch mode
npm run test -- --watch

# Coverage
npm run test -- --coverage

# Testes E2E
npm run test:e2e</code></pre>
            </section>

            <!-- 14. Deploy -->
            <section id="deploy">
                <h2>14. Deploy e Infraestrutura</h2>
                
                <h3>14.1 Arquitetura de Deploy</h3>
                <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         VERCEL                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                 Next.js Application                  â”‚   â”‚
â”‚  â”‚  - Edge Functions                                    â”‚   â”‚
â”‚  â”‚  - Server Components                                 â”‚   â”‚
â”‚  â”‚  - API Routes                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTPS
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          VPS                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚      Nginx      â”‚â”€â”€â”€â–ºâ”‚      Node Service           â”‚    â”‚
â”‚  â”‚  (Reverse Proxy)â”‚    â”‚  (PM2 managed)              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTPS
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SUPABASE CLOUD                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  PostgreSQL â”‚  â”‚   Storage   â”‚  â”‚    Realtime     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                </div>
                
                <h3>14.2 Deploy no Vercel</h3>
                <pre><code># Instalar Vercel CLI
npm i -g vercel

# Deploy
vercel

# Deploy produÃ§Ã£o
vercel --prod</code></pre>
                
                <h3>14.3 Deploy do Node Service (VPS)</h3>
                <pre><code># Conectar na VPS
ssh user@your-vps-ip

# Navegar para o projeto
cd /var/www/aviator-engine

# Atualizar cÃ³digo
git pull origin main

# Instalar dependÃªncias
cd node-service
npm install

# Build
npm run build

# Reiniciar com PM2
pm2 restart aviator-engine</code></pre>
                
                <h3>14.4 ConfiguraÃ§Ã£o Nginx</h3>
                <pre><code># /etc/nginx/sites-available/aviator-engine.conf
server {
    listen 80;
    server_name api.seudominio.com;
    
    location / {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}</code></pre>
            </section>

            <!-- 15. Troubleshooting -->
            <section id="troubleshooting">
                <h2>15. ManutenÃ§Ã£o e Troubleshooting</h2>
                
                <h3>15.1 Logs</h3>
                <pre><code># Logs em tempo real
pm2 logs aviator-engine

# Ãšltimas 100 linhas
pm2 logs aviator-engine --lines 100

# Logs de erro
pm2 logs aviator-engine --err</code></pre>
                
                <h3>15.2 Problemas Comuns</h3>
                
                <div class="alert alert-danger">
                    <strong>Erro de Hydration</strong><br>
                    "Hydration failed because the server rendered HTML didn't match the client"
                </div>
                <p><strong>SoluÃ§Ã£o:</strong> Usar <span class="inline-code">dynamic()</span> com <span class="inline-code">ssr: false</span> para componentes com estado dinÃ¢mico</p>
                <pre><code>const DynamicComponent = dynamic(() => import('./Component'), {
  ssr: false,
  loading: () => &lt;Skeleton /&gt;
});</code></pre>
                
                <div class="alert alert-danger">
                    <strong>Erro RLS (Row Level Security)</strong><br>
                    "new row violates row-level security policy"
                </div>
                <p><strong>SoluÃ§Ã£o:</strong> Verificar polÃ­ticas RLS no Supabase Dashboard e usar Server Actions com <span class="inline-code">getSupabaseServerClient()</span></p>
                
                <h3>15.3 Comandos Ãšteis</h3>
                <pre><code># Frontend
npm run dev          # Desenvolvimento
npm run build        # Build produÃ§Ã£o
npm run lint         # Linting
npm run test         # Testes

# Node Service
npm run dev          # Desenvolvimento
npm run build        # Build
pm2 start            # Iniciar produÃ§Ã£o
pm2 restart all      # Reiniciar
pm2 logs             # Ver logs

# Supabase
npx supabase start   # Local
npx supabase db push # Push migrations
npx supabase gen types typescript # Gerar tipos</code></pre>
            </section>
        </div>
        
        <footer>
            <p><strong>DocumentaÃ§Ã£o TÃ©cnica - Plataforma Aviator</strong></p>
            <p>Ãšltima atualizaÃ§Ã£o: Dezembro 2025</p>
            <p style="margin-top: 10px; font-size: 0.9em;">Documento confidencial - Uso restrito Ã  equipe de desenvolvimento</p>
        </footer>
    </div>
</body>
</html>
